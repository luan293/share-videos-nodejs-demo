extends ./layout
block content
  script(type='text/javascript').   
    var idvideo = #{video.idvideo};
    var like = #{video.like};
    var dislike = #{video.dislike};
    //var id = #{video.idauthor};
    //if (id == 'null'){
    //  id = null;
    //}

    $(document).ready(function() {  
      var state = #{video.state};
      var prestate = #{video.prestate};   
      checkState = function(state)  {
        if(state == 1){
          $('#like-button').css({'font-size': '20px'});
          $('#dislike-button').css({'font-size': '14px'});
        } else if(like == 2) {
          $('#dislike-button').css({'font-size': '20px'});
          $('#like-button').css({'font-size': '14px'});
          
        } else {
          $('#like-button').css({'font-size': '14px'});
          $('#dislike-button').css({'font-size': '14px'});
        }
        console.log(state)
      }
      checkState(state);
      
      $('#like-button').click(function() {
        if(state == 0){
          prestate = state;
          state = 1;
        } else if (state == 1){
          prestate = state;
          state = 0;
        } else {
          prestate = state;
          state = 1;
        }
        checkState(state);
        changeState(state, prestate, idvideo, like, dislike);
      });

      $('#dislike-button').click(function() {
        if(state == 0){
          prestate = state;
          state = 2;         
        } else if (state == 1){
          prestate = state;
          state = 2;
        } else {
          prestate = state;
          state = 0;
        }
        checkState(state);
        changeState(state, prestate, idvideo, like, dislike);
      });
      changeState = function(state, prestate, idvideo, like, dislike) {
        $.ajax({
          type: 'POST',
          data: { state: state, prestate: prestate, idvideo: idvideo, like: like, dislike: dislike },
          dataType: 'json',
          url: 'http://127.0.0.1:3000/like',
          success: function(data1) {
            //console.log(data1);
          },
          error: function(xhr, status, err) {
            //console.log(err);
          },
          complete: function(data2) {
            //console.log(data2);
          }
        });
      }
    });

  div.container.container-background
    .wrap
      .row
        .details       
          iframe(width='660', height='371', src=video.url)
          div.state
            a(id='like-button', class='glyphicon glyphicon-thumbs-up', href="javascript:void(0)") #{video.like}
            a(id='dislike-button', class='glyphicon glyphicon-thumbs-down', href="javascript:void(0)") #{video.dislike}
      -var cmtfb = 'http://127.0.0.1:3000/vid/' + video.idvideo;
      div.fb-comments(data-href=cmtfb, data-numposts="3")
  